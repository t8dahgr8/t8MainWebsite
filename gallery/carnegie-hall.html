<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Carnegie Hall – Gallery – Tayte Choudhury</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{ --page-bg:#0B1D16; --surface:#0F241C; --ink:#E6EEE9; --muted:#CBE7DD; --border:#1E4033; }
    .theme-light{ --page-bg:#F7F8F3; --surface:#FFFFFF; --ink:#0B1D16; --muted:#364A43; --border:#D9E6E1; }
    .theme-tamu{ --page-bg:#FAF7F2; --surface:#FFFFFF; --ink:#2B1A1D; --muted:#6C4A4A; --border:#E7D9CF; }
    body{ background:var(--page-bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .thumb{ border:1px solid var(--border); border-radius:.75rem; width:100%; aspect-ratio: 4 / 3; object-fit:cover; cursor:zoom-in; }
    #lightbox{ backdrop-filter:saturate(120%) blur(2px); }
  </style>
</head>
<body>
  <main class="max-w-7xl mx-auto px-6 pt-28 pb-16">
    <div class="flex items-center justify-between mb-6">
      <a href="../gallery.html" class="text-[color:var(--muted)] hover:text-white">
        <i class="fa-solid fa-arrow-left mr-2"></i> Back to Gallery
      </a>
      <div class="space-x-2 text-sm">
        <button class="px-3 py-1 rounded border border-[color:var(--border)]" data-theme="dark">Dark</button>
        <button class="px-3 py-1 rounded border border-[color:var(--border)]" data-theme="light">Light</button>
        <button class="px-3 py-1 rounded border border-[color:var(--border)]" data-theme="tamu">TAMU</button>
      </div>
    </div>

    <h1 class="text-3xl font-bold">Carnegie Hall</h1>
    <p class="text-[color:var(--muted)] mt-2">Auto-generated grid from <code>Images/Gallery/Carnegie</code>.</p>

    <!-- Auto grid -->
    <div id="grid" class="mt-6 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3"></div>

    <!-- Lightbox -->
    <div id="lightbox" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/80 p-4">
      <img id="lb-img" class="max-w-[90vw] max-h-[90vh] rounded-lg shadow-2xl border border-white/10 block" alt="preview">
      <button id="lb-close" class="absolute top-4 right-4 text-white/90 text-3xl leading-none px-2">×</button>
      <button id="lb-prev"  class="absolute left-4  top-1/2 -translate-y-1/2 text-white/90 text-4xl px-2">‹</button>
      <button id="lb-next"  class="absolute right-4 top-1/2 -translate-y-1/2 text-white/90 text-4xl px-2">›</button>
    </div>
  </main>

  <script>
    /* 1) Theme inherit */
    (function(){
      const mode = localStorage.getItem('theme') || 'dark';
      document.documentElement.classList.remove('theme-light','theme-tamu');
      if(mode==='light') document.documentElement.classList.add('theme-light');
      if(mode==='tamu')  document.documentElement.classList.add('theme-tamu');
      document.querySelectorAll('[data-theme]').forEach(b=>b.addEventListener('click',()=>{
        localStorage.setItem('theme', b.dataset.theme); location.reload();
      }));
    })();

    /* 2) Repo config — set these once */
    const GH = {
      owner  : 't8dahgr8',     // <-- change
      repo   : 't8MainWebsite',       // <-- change
      branch : 'main'                  // or 'master'
    };
    const ALBUM_PATH = 'Images/Gallery/Carnegie'; // folder to scan (in repo)

    /* 3) Fetch folder contents from GitHub, render grid */
    const grid   = document.getElementById('grid');
    const apiURL = `https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${ALBUM_PATH}?ref=${GH.branch}`;
    const exts   = /\.(jpe?g|png|webp|gif|bmp|svg)$/i;

    async function loadAlbum() {
      try {
        const res = await fetch(apiURL, { headers: { 'Accept': 'application/vnd.github+json' } });
        if (!res.ok) throw new Error('GitHub API error ' + res.status);
        const items = await res.json();

        // Filter files, sort alphabetically (1..10..)
        const files = items
          .filter(f => f.type === 'file' && exts.test(f.name))
          .sort((a,b)=> a.name.localeCompare(b.name, undefined, { numeric:true }));

        if (!files.length) {
          grid.innerHTML = `<p class="text-[color:var(--muted)]">No images found in <code>${ALBUM_PATH}</code>.</p>`;
          return;
        }

        const frag = document.createDocumentFragment();
        files.forEach(f => {
          const img = document.createElement('img');
          img.src = f.download_url;           // direct link to the image
          img.alt = f.name;
          img.className = 'thumb object-center';
          frag.appendChild(img);
        });
        grid.appendChild(frag);

        wireLightbox();  // after images are in the DOM
      } catch (e) {
        grid.innerHTML = `<p class="text-[color:var(--muted)]">Could not load album (rate limit or path). Set repo in the page code and ensure the folder exists.</p>`;
        console.error(e);
      }
    }

    /* 4) Lightbox */
    function wireLightbox(){
      const thumbs = Array.from(document.querySelectorAll('.thumb'));
      const overlay = document.getElementById('lightbox');
      const imgEl   = document.getElementById('lb-img');
      const bPrev   = document.getElementById('lb-prev');
      const bNext   = document.getElementById('lb-next');
      const bClose  = document.getElementById('lb-close');
      let idx = 0;

      function openAt(i){
        idx = (i + thumbs.length) % thumbs.length;
        const t = thumbs[idx];
        imgEl.src = t.dataset.full || t.src;
        imgEl.alt = t.alt || 'preview';
        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
      function closeLB(){ overlay.classList.add('hidden'); imgEl.src=''; document.body.style.overflow=''; }
      function next(){ openAt(idx+1); }
      function prev(){ openAt(idx-1); }

      thumbs.forEach((t,i)=> t.addEventListener('click',()=>openAt(i)));
      bClose.addEventListener('click', closeLB);
      bNext.addEventListener('click', next);
      bPrev.addEventListener('click', prev);
      overlay.addEventListener('click', e => { if(e.target===overlay) closeLB(); });
      window.addEventListener('keydown', e => {
        if(overlay.classList.contains('hidden')) return;
        if(e.key==='Escape') closeLB();
        if(e.key==='ArrowRight') next();
        if(e.key==='ArrowLeft')  prev();
      });
    }

    loadAlbum();
  </script>
</body>
</html>
